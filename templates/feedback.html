{% extends 'base.html' %}
{% block content %}
<h2>Feedback</h2>

<form id="feedbackForm" method="POST">
    {{ form.csrf_token }}
    {{ form.name.label }}<br>
    {{ form.name(size=40) }}<br><br>

    {{ form.message.label }}<br>
    {{ form.message(rows=4, cols=50) }}<br><br>

    {{ form.submit() }}
</form>

<ul>
    {% for fb in feedbacks %}
        <li><strong>{{ fb.name or "Anonymous" }}</strong>: {{ fb.message }}</li>
    {% endfor %}
</ul>

<a class="btn" href="{{ url_for('home') }}">Back to Home</a>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("feedbackForm");
    form.addEventListener("submit", (e) => {
        const isLoggedIn = document.cookie.includes("session=");
        if (!isLoggedIn) {
            let pts = parseInt(localStorage.getItem("guest_points")) || 0;
            alert("You earned +5 eco points (guest). Total: " + pts);
        }
    });
});
</script>
{% endblock %}